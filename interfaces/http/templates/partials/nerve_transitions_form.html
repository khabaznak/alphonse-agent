<div id="nerve-transitions-form">
  <form
    class="form-grid"
    hx-post="{% if transition %}/nerve/transitions/{{ transition.id }}{% else %}/nerve/transitions{% endif %}"
    hx-target="#nerve-transitions-table"
    hx-swap="outerHTML"
  >
    <label>
      Current State
      <select name="state_id" required>
        <option value="" disabled {% if not transition %}selected{% endif %}>Select state</option>
        {% for state in states %}
          <option
            value="{{ state.id }}"
            {% if transition and transition.state_id == state.id %}selected{% endif %}
          >
            {{ state.name }} ({{ state.key }})
          </option>
        {% endfor %}
      </select>
    </label>
    <label>
      Signal
      <select name="signal_id" required>
        <option value="" disabled {% if not transition %}selected{% endif %}>Select signal</option>
        {% for signal in signals %}
          <option
            value="{{ signal.id }}"
            {% if transition and transition.signal_id == signal.id %}selected{% endif %}
          >
            {{ signal.name }} ({{ signal.key }})
          </option>
        {% endfor %}
      </select>
    </label>
    <label>
      Next State
      <select name="next_state_id" required>
        <option value="" disabled {% if not transition %}selected{% endif %}>Select next state</option>
        {% for state in states %}
          <option
            value="{{ state.id }}"
            {% if transition and transition.next_state_id == state.id %}selected{% endif %}
          >
            {{ state.name }} ({{ state.key }})
          </option>
        {% endfor %}
      </select>
    </label>
    <label>
      Priority
      <input type="number" name="priority" value="{{ transition.priority if transition else 100 }}" required>
    </label>
    <label>
      Enabled
      <input type="checkbox" name="is_enabled" {% if transition and transition.is_enabled %}checked{% elif not transition %}checked{% endif %}>
    </label>
    <label>
      Match Any State
      <input type="checkbox" name="match_any_state" {% if transition and transition.match_any_state %}checked{% endif %}>
    </label>
    <label>
      Guard Key
      <input type="text" name="guard_key" value="{{ transition.guard_key if transition else '' }}">
    </label>
    <label>
      Action Key
      <input type="text" name="action_key" value="{{ transition.action_key if transition else '' }}">
    </label>
    <label class="form-full">
      Notes
      <textarea name="notes" rows="3">{{ transition.notes if transition else '' }}</textarea>
    </label>
    <div class="form-actions form-full">
      <button type="submit">{% if transition %}Save transition{% else %}Create transition{% endif %}</button>
    </div>
  </form>
</div>
